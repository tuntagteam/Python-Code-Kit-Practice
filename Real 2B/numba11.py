import pandas as pd  # à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸šà¸šà¸•à¸²à¸£à¸²à¸‡
from datetime import time  # à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸™à¸´à¸¢à¸²à¸¡à¹€à¸§à¸¥à¸²à¸•à¸±à¸”à¸ªà¸²à¸¢ à¹€à¸Šà¹ˆà¸™ 10:30

# à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸³à¸¥à¸­à¸‡à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š DataFrame
df = pd.DataFrame({
    'employee_id': ['E01', 'E01', 'E02', 'E02', 'E03', 'E03'],  # ID à¸‚à¸­à¸‡à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸™
    'date': ['2024-05-01', '2024-05-02'] * 3,  # à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸‡à¸²à¸™ (à¸§à¸™à¸¥à¸¹à¸› 2 à¸§à¸±à¸™ x 3 à¸„à¸™)
    'checkin_time': ['10:55', '10:35', '10:39', '10:40', '11:00', '10:49']  # à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¹€à¸Šà¹‡à¸à¸­à¸´à¸™ (à¹€à¸›à¹‡à¸™ string)
})

# à¹à¸›à¸¥à¸‡ checkin_time à¸ˆà¸²à¸ string à¹€à¸›à¹‡à¸™à¸Šà¸™à¸´à¸”à¹€à¸§à¸¥à¸² (datetime.time) à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¹€à¸§à¸¥à¸²à¹„à¸”à¹‰
df['checkin_time'] = pd.to_datetime(df['checkin_time'], format='%H:%M').dt.time

# à¸™à¸´à¸¢à¸²à¸¡à¹€à¸§à¸¥à¸²à¸•à¸±à¸”à¸ªà¸²à¸¢ = 10:30 AM (à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸™à¸µà¹‰à¸–à¸·à¸­à¸§à¹ˆà¸²à¸ªà¸²à¸¢)
cutoff_time = time(10, 30)

# à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸«à¸¡à¹ˆà¸Šà¸·à¹ˆà¸­ 'late' à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ True/False à¸§à¹ˆà¸²à¸¡à¸²à¸ªà¸²à¸¢à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
df['late'] = df['checkin_time'] > cutoff_time
# à¸–à¹‰à¸²à¹€à¸§à¸¥à¸²à¹€à¸Šà¹‡à¸à¸­à¸´à¸™ > 10:30 à¸ˆà¸°à¹„à¸”à¹‰à¸„à¹ˆà¸² True â†’ à¸ªà¸²à¸¢
# à¸–à¹‰à¸² <= 10:30 à¸ˆà¸°à¹„à¸”à¹‰à¸„à¹ˆà¸² False â†’ à¹„à¸¡à¹ˆà¸ªà¸²à¸¢

# ðŸ”¹ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: à¸«à¸²à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢à¸šà¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”
# à¸à¸£à¸­à¸‡à¹€à¸‰à¸žà¸²à¸°à¹à¸–à¸§à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢ (late == True)
late_df = df[df['late']]

# groupby à¸•à¸²à¸¡ employee à¹à¸¥à¹‰à¸§à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¹à¸–à¸§ (size) â†’ à¸„à¸·à¸­à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢
late_counts = late_df.groupby('employee_id').size()

# à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸¡à¸µà¹ƒà¸„à¸£à¸¡à¸²à¸ªà¸²à¸¢à¸šà¹‰à¸²à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
if not late_counts.empty:
    most_late_emp = late_counts.idxmax()  # à¸«à¸² employee_id à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢à¸šà¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”
    most_late_times = late_counts.max()   # à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”
    print(f"à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸¡à¸²à¸ªà¸²à¸¢à¸šà¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”: {most_late_emp} ({most_late_times} à¸„à¸£à¸±à¹‰à¸‡)")
else:
    print("à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸„à¸£à¸¡à¸²à¸ªà¸²à¸¢à¹€à¸¥à¸¢!")

# ðŸ”¹ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: à¸«à¸²à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸„à¸¢à¸¡à¸²à¸ªà¸²à¸¢à¹€à¸¥à¸¢
# à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™ DataFrame
all_employees = df['employee_id'].unique()

# à¸„à¸±à¸”à¹€à¸‰à¸žà¸²à¸°à¸„à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ late_counts â†’ à¸„à¸·à¸­à¹„à¸¡à¹ˆà¹€à¸„à¸¢à¸¡à¸²à¸ªà¸²à¸¢
on_time_employees = [emp for emp in all_employees if emp not in late_counts.index]

# à¹à¸ªà¸”à¸‡à¸œà¸¥à¸œà¸¹à¹‰à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸„à¸¢à¸¡à¸²à¸ªà¸²à¸¢
if on_time_employees:
    print("à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸„à¸¢à¸¡à¸²à¸ªà¸²à¸¢:", ", ".join(on_time_employees))
else:
    print("à¸—à¸¸à¸à¸„à¸™à¹€à¸„à¸¢à¸¡à¸²à¸ªà¸²à¸¢à¸«à¸¡à¸”")

# ðŸ”¹ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 3: à¸ªà¸£à¹‰à¸²à¸‡ Pivot Table à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸¡à¸²à¸ªà¸²à¸¢à¸£à¸²à¸¢à¸§à¸±à¸™
# - index = employee_id â†’ à¹à¸–à¸§à¸„à¸·à¸­à¸žà¸™à¸±à¸à¸‡à¸²à¸™
# - columns = date â†’ à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸„à¸·à¸­à¸§à¸±à¸™à¸—à¸µà¹ˆ
# - values = late â†’ à¸„à¹ˆà¸²à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡à¸„à¸·à¸­ True/False à¸§à¹ˆà¸²à¸¡à¸²à¸ªà¸²à¸¢à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
pivot = df.pivot_table(index='employee_id', columns='date', values='late', aggfunc='first')

# à¹à¸ªà¸”à¸‡à¸œà¸¥ Pivot Table à¸žà¸£à¹‰à¸­à¸¡à¹€à¸•à¸´à¸¡ '-' à¹à¸—à¸™ NaN (à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸‚à¹‰à¸²à¸‡à¸²à¸™à¸§à¸±à¸™à¸™à¸±à¹‰à¸™)
print("\nPivot Table:")
print(pivot.fillna('-'))